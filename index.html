<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Breakout — HUD Top5 高質感樣品 (Pro v3 • fixA)</title>
<style>
  :root{
    --safe-top: env(safe-area-inset-top);
    --safe-bottom: env(safe-area-inset-bottom);
    --ink:#eaf2ff;
    --ink-2:#cbd8f6;
    --muted:#a7b6d9;
    --glass-stroke: rgba(132,198,255,.26);
    --glass-1: rgba(255,255,255,.08);
    --glass-2: rgba(255,255,255,.05);
    --accent:#77c8ff;
    --hudTop: 120px; /* 由 JS 寫入：HUD 底緣（絕對座標） */
  }

  html,body{height:100%;margin:0;color:var(--ink);
    background:radial-gradient(140% 140% at 50% -10%, #0f1a35 0%, #0b142c 55%, #0a1122 100%);
    font-family: ui-sans-serif, -apple-system, system-ui, "Segoe UI", Roboto, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Arial, sans-serif;
    -webkit-font-smoothing: antialiased;}

  .wrap{max-width:1200px;margin:0 auto;padding:0 12px 24px}

  header{padding:calc(8px + var(--safe-top)) 0 10px;display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between}
  header h1{font-size:clamp(16px,2.4vw,22px);margin:0 6px 0 0;letter-spacing:.6px;opacity:.96}
  .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .tag{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid var(--glass-stroke);background:var(--glass-1);color:#dce6ff;font-size:12px}
  .select,.btn{height:38px;border-radius:12px;padding:0 12px;border:1px solid var(--glass-stroke);background:var(--glass-2);color:#fff}
  .btn{font-weight:700;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .small{font-size:12px;color:var(--muted)}

  .stage{position:relative;max-width:min(1080px,96vw);margin:10px auto 18px;border-radius:18px;padding:16px}
  .board{height:min(62vh,560px);border-radius:16px;border:1px solid rgba(70,100,160,.45);
    background:radial-gradient(140% 140% at 50% -10%, #0b1730, #0b1226 58%, #0a1123);
    box-shadow:inset 0 0 160px rgba(255,255,255,.03),0 30px 90px rgba(0,0,0,.45);}

  /* ====== HUD primitives ====== */
  .hud{position:relative;z-index:40;display:grid;align-items:center;gap:10px}
  .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .pill{display:flex;align-items:center;gap:8px;padding:6px 12px;min-height:36px;border-radius:999px;background:var(--glass-2);border:1px solid var(--glass-stroke);color:var(--ink-2)}
  .pill strong{color:#fff}
  .hearts{margin-left:6px;letter-spacing:2px}
  .ring{--size:48px;width:var(--size);height:var(--size);border-radius:50%;display:grid;place-items:center;cursor:pointer;position:relative;
        background:radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,.16), rgba(255,255,255,0) 60%), var(--glass-1);
        border:1px solid var(--glass-stroke);box-shadow:inset 0 0 0 1px rgba(255,255,255,.05),0 12px 28px rgba(0,0,0,.35)}
  .ring:active{transform:translateY(1px)}
  .bars{width:16px;height:18px;display:grid;grid-template-columns:1fr 1fr;gap:4px}
  .bars span{background:#fff;border-radius:2px}
  .ghost{font-size:22px}

  .menu{position:absolute;top:56px;right:0;min-width:280px;background:rgba(12,18,36,.96);border:1px solid var(--glass-stroke);border-radius:14px;
        padding:10px;transform:scale(.96);opacity:0;pointer-events:none;transition:.16s ease;z-index:60;backdrop-filter:blur(8px)}
  .menu.show{transform:scale(1);opacity:1;pointer-events:auto}
  .menu .row{margin-bottom:8px}
  .menu .item{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:10px;border:1px solid var(--glass-stroke);background:var(--glass-2)}
  .menu .item .ic{width:20px;text-align:center;opacity:.9}
  .menu h4{margin:6px 0 8px;font-size:13px;letter-spacing:.2px;color:#cfe0ff}

  /* ====== Effect chips & prompt cards (fixed below HUD; never overlap) ====== */
  #activeBuffs{position:fixed;left:12px;top:calc(var(--hudTop) + 6px);z-index:20;display:flex;gap:8px;align-items:center;max-width:calc(100vw - 64px);overflow-x:auto;scrollbar-width:none;pointer-events:none}
  #activeBuffs > *{pointer-events:auto}
  #activeBuffs::-webkit-scrollbar{display:none}
  .chip{padding:4px 10px;border:1px solid var(--glass-stroke);background:var(--glass-1);border-radius:999px;font-size:12px;color:#cfe0ff;white-space:nowrap}
  .chip b{color:#fff}
  .prompts{position:fixed;left:12px;top:calc(var(--hudTop) + 48px);z-index:18;display:flex;flex-direction:column;gap:8px;pointer-events:none}
  .prompt{pointer-events:auto;padding:10px 12px;border:1px solid var(--glass-stroke);background:rgba(16,22,40,.92);border-radius:12px;box-shadow:0 12px 34px rgba(0,0,0,.35)}

  /* ====== Theme variants（略，與上一版相同） ====== */
  .theme-sapphire .hud{grid-template-columns:1fr auto;background:linear-gradient(180deg, rgba(18,28,52,.60), rgba(12,22,44,.40));
    border:1px solid var(--glass-stroke);border-radius:18px;padding:12px;margin:10px auto 0;max-width:860px}
  .theme-slate .hud{display:none}
  .theme-slate .dock{position:fixed;bottom:calc(8px + var(--safe-bottom));left:50%;transform:translateX(-50%);z-index:30;
    display:flex;gap:8px;padding:10px 12px;background:rgba(16,20,30,.78);border:1px solid rgba(120,190,255,.26);
    border-radius:16px;backdrop-filter:blur(10px)}
  .theme-neon .hud{grid-template-columns:auto 1fr auto;margin-top:10px}
  .theme-neon .leftbar{display:flex;flex-direction:column;gap:8px}
  .theme-aero .hud{grid-template-columns:1fr;justify-items:center;margin-top:10px}
  .theme-aero .capsule{display:flex;gap:12px;padding:8px 12px;border:1px solid var(--glass-stroke);border-radius:999px;background:var(--glass-1)}
  .theme-ivory .hud{grid-template-columns:260px 1fr;align-items:start;margin-top:10px}
  .theme-ivory .panel{border:1px solid rgba(170,180,210,.45);background:rgba(255,255,255,.05);border-radius:14px;padding:12px 10px;display:flex;flex-direction:column;gap:8px}
  @media (max-width:560px){ .theme-ivory .hud{grid-template-columns:1fr} }
</style>
</head>
<body>
<div class="wrap theme-sapphire" id="app">
  <header>
    <h1>Breakout HUD — Top 5 高質感樣品（fixA）</h1>
    <div class="toolbar">
      <span class="tag">切換樣式</span>
      <select id="skinSel" class="select">
        <option value="theme-sapphire">1) Sapphire Glass（上方玻璃列）</option>
        <option value="theme-slate">2) Slate Dock（底部工具列）</option>
        <option value="theme-neon">3) Neon Split（左統計 / 右控制）</option>
        <option value="theme-aero">4) Aero Capsule（頂端膠囊）</option>
        <option value="theme-ivory">5) Ivory Sidebar（左側控制板）</option>
      </select>
      <span class="small">規格：Start/Stop 無子選單；音效/選項展開即停，點空白關閉並續玩；效果倒數／提示卡永不與 HUD 重疊。</span>
    </div>
  </header>

  <!-- 固定的效果倒數 & 提示卡區 -->
  <div id="activeBuffs" aria-live="polite">
    <div class="chip">🧲 <b>8.3</b>s</div>
    <div class="chip">❄️ <b>12.1</b>s</div>
    <div class="chip">🎯 <b>5.0</b>s</div>
  </div>
  <div class="prompts" id="prompts">
    <div class="prompt">提示：點「音效」或「選項」會暫停，點空白處關閉並繼續</div>
  </div>

  <!-- 主題區塊（與上一版相同，省略為簡） -->
  <section class="theme-slot" data-theme="theme-sapphire">
    <div class="hud" role="region" aria-label="Sapphire Glass HUD">
      <div class="row">
        <div class="pill">分數 <strong data-bind="score">1,280</strong></div>
        <div class="pill">關卡 <strong data-bind="level">1</strong>/20</div>
        <div class="pill">生命 <strong data-bind="lives">3</strong><span class="hearts">❤️❤️❤️</span></div>
      </div>
      <div class="row" style="justify-self:end;position:relative">
        <button class="ring" data-as="start" aria-label="開始/暫停"><span class="bars"><span></span><span></span></span></button>
        <button class="ring ghost" data-as="sound" aria-haspopup="true" aria-expanded="false" aria-controls="soundMenu-1">🔊</button>
        <div class="menu" id="soundMenu-1">
          <div class="item"><span class="ic">🎵</span><label><input type="checkbox" checked> BGM 開關</label></div>
          <div class="item"><span class="ic">🎚</span><label style="width:100%">BGM 音量 <input type="range" min="0" max="1" step="0.01" value="0.7" style="width:60%"></label></div>
          <div class="item"><span class="ic">🔈</span><label><input type="checkbox" checked> 音效開關</label></div>
        </div>
        <button class="ring ghost" data-as="opt" aria-haspopup="true" aria-expanded="false" aria-controls="optMenu-1">⋯</button>
        <div class="menu" id="optMenu-1">
          <h4>遊戲</h4>
          <div class="item"><span class="ic">🎮</span>難度
            <select class="select"><option>簡單</option><option selected>一般</option><option>困難</option></select></div>
          <div class="row">
            <button class="btn">重新開始</button>
            <button class="btn">存檔</button>
            <button class="btn">讀檔</button>
          </div>
          <h4>其他</h4>
          <div class="row">
            <button class="btn">全螢幕</button>
            <button class="btn">教學</button>
            <button class="btn">效果說明</button>
            <button class="btn">畫廊</button>
            <button class="btn">排行榜</button>
          </div>
          <div class="item"><span class="ic">🎨</span>Skin
            <select class="select"><option>1) Sapphire Glass</option><option>2) Slate Dock</option><option>3) Neon Split</option><option>4) Aero Capsule</option><option>5) Ivory Sidebar</option></select></div>
        </div>
      </div>
    </div>
    <div class="stage"><div class="board"></div></div>
  </section>

  <!-- 其他四個主題與上一版一致（此處省略） -->

</div>

<script>
(function(){
  const app = document.getElementById('app');
  const slots = document.querySelectorAll('.theme-slot');
  const skinSel = document.getElementById('skinSel');
  let running = true;
  let hudEl = null;
  let ro = null;

  function start(){ running = true; document.body.classList.remove('stopped'); }
  function stop(){ running = false; document.body.classList.add('stopped'); }

  function setTheme(cls){
    app.classList.remove('theme-sapphire','theme-slate','theme-neon','theme-aero','theme-ivory');
    app.classList.add(cls);
    slots.forEach(sec=>{ sec.hidden = sec.dataset.theme !== cls; });
    // 重新取得 HUD 參考並監看尺寸
    const visible = Array.from(slots).find(s=>!s.hidden);
    hudEl = visible ? (visible.querySelector('.hud') || visible.querySelector('.dock')) : null;
    if(ro){ ro.disconnect(); }
    if(window.ResizeObserver && hudEl){
      ro = new ResizeObserver(placeHud);
      ro.observe(hudEl);
    }
    placeHud();
  }

  function placeHud(){
    if(!hudEl) return;
    const r = hudEl.getBoundingClientRect();
    // 取 HUD 「底緣到視窗頂端的絕對座標」→ 保證 chips 一定在 HUD 之下
    const top = Math.ceil(r.bottom) + 6;
    document.documentElement.style.setProperty('--hudTop', top + 'px');
  }

  // Start/Stop & Menu
  function wire(section){
    section.querySelectorAll('[data-as="start"]').forEach(btn=>{
      btn.addEventListener('click', ()=>{ running ? stop() : start(); });
    });
    const soundBtn = section.querySelector('[data-as="sound"]');
    const soundMenu = section.querySelector('[data-as="soundMenu"]') || section.querySelector('#soundMenu-1');
    const optBtn   = section.querySelector('[data-as="opt"]');
    const optMenu  = section.querySelector('[data-as="optMenu"]') || section.querySelector('#optMenu-1');

    function toggleMenu(menu, btn){
      const show = !menu.classList.contains('show');
      closeMenus();
      if(show){ menu.classList.add('show'); btn?.setAttribute('aria-expanded','true'); stop(); }
      else { btn?.setAttribute('aria-expanded','false'); start(); }
    }
    if(soundBtn && soundMenu){
      soundBtn.addEventListener('click', (e)=>{ e.stopPropagation(); toggleMenu(soundMenu, soundBtn); });
    }
    if(optBtn && optMenu){
      optBtn.addEventListener('click', (e)=>{ e.stopPropagation(); toggleMenu(optMenu, optBtn); });
    }
  }

  function closeMenus(){
    document.querySelectorAll('.menu.show').forEach(m=>m.classList.remove('show'));
    start();
  }

  document.addEventListener('click', (e)=>{
    if(e.target.closest('.menu') || e.target.closest('[data-as="sound"]') || e.target.closest('[data-as="opt"]')) return;
    if(document.querySelector('.menu.show')) closeMenus();
  }, {passive:true});

  // 視口變化監聽：旋轉、縮放（iOS visualViewport）與字體載入完成後都重新定位
  window.addEventListener('resize', placeHud, {passive:true});
  window.addEventListener('orientationchange', placeHud);
  if(window.visualViewport){
    visualViewport.addEventListener('resize', placeHud);
    visualViewport.addEventListener('scroll', placeHud);
  }
  if(document.fonts && document.fonts.ready){
    document.fonts.ready.then(placeHud);
  }

  // Demo chips 倒數
  const chips = document.querySelectorAll('.chip b');
  setInterval(()=>{
    if(!running) return;
    chips.forEach(el=>{
      let v = parseFloat(el.textContent);
      v = Math.max(0, v - 0.1);
      el.textContent = v.toFixed(1);
    });
  }, 100);

  // init
  document.querySelectorAll('.theme-slot').forEach(wire);
  skinSel.addEventListener('change', e=> setTheme(e.target.value));
  setTheme('theme-sapphire');
  start();
  placeHud();
})();
</script>
</body>
</html>
